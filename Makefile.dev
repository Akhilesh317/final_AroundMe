# Development-specific Makefile targets
.PHONY: dev-setup dev-reset dev-logs dev-shell-api dev-shell-web dev-test-watch

dev-setup: install-api install-web
	@echo "Setting up development environment..."
	cd apps/api && pre-commit install
	@echo "✓ Development environment ready!"

dev-reset:
	@echo "Resetting development environment..."
	docker compose -f deploy/compose.yml down -v
	docker compose -f deploy/compose.yml up -d postgres redis
	sleep 5
	cd apps/api && alembic upgrade head
	cd apps/api && python -m app.db.seed
	@echo "✓ Environment reset complete!"

dev-logs:
	docker compose -f deploy/compose.yml logs -f api web

dev-shell-api:
	docker compose -f deploy/compose.yml exec api /bin/sh

dev-shell-web:
	docker compose -f deploy/compose.yml exec web /bin/sh

dev-shell-postgres:
	docker compose -f deploy/compose.yml exec postgres psql -U aroundme -d aroundme

dev-shell-redis:
	docker compose -f deploy/compose.yml exec redis redis-cli

dev-test-watch:
	cd apps/api && ptw -- -v

dev-lint-fix:
	cd apps/api && black . && isort . && ruff check . --fix
	cd apps/web && npm run lint --fix

dev-db-reset:
	docker compose -f deploy/compose.yml exec postgres psql -U aroundme -d aroundme -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"
	cd apps/api && alembic upgrade head
	cd apps/api && python -m app.db.seed

dev-cache-clear:
	docker compose -f deploy/compose.yml exec redis redis-cli FLUSHALL

dev-backup-db:
	docker compose -f deploy/compose.yml exec postgres pg_dump -U aroundme aroundme > backup_$(shell date +%Y%m%d_%H%M%S).sql

dev-restore-db:
	@echo "Usage: make dev-restore-db FILE=backup_20240115_120000.sql"
	docker compose -f deploy/compose.yml exec -T postgres psql -U aroundme aroundme < $(FILE)